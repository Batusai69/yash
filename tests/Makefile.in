# Makefile.in for test of yash
# (C) 2007-2010 magicant
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 2 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

.POSIX:
.SUFFIXES: .c .h .d .o

CC = @CC@
CFLAGS = @CFLAGS@
LDFLAGS = @LDFLAGS@
LDLIBS = @LDLIBS@
SOURCES = invoke.c resetsig.c
TEST_SOURCES = alias.p.tst alias.p.out alias.y.tst alias.y.out \
	builtin.p.tst builtin.p.out builtin.y.tst builtin.y.out dot.t \
	dirstack.y.tst dirstack.y.out \
	error.p.tst error.p.out error.y.tst error.y.out error.y.err \
	expand.p.tst expand.p.out expand.y.tst expand.y.out \
	fnmatch.p.tst fnmatch.p.out \
	history.y.tst history.y.out \
	input.p.tst input.p.out input.p.err input.p.oux input.p.erx input.p.t \
	input.y.tst input.y.out input.y.err input.y.erx input.y.t \
	job.p.tst job.p.out \
	option.p.tst option.p.out option.p.err option.y.tst option.y.out \
	parser.p.tst parser.p.out parser.y.tst parser.y.out \
	path.p.tst path.p.out path.y.tst path.y.out \
	printf.y.tst printf.y.out \
	redir.p.tst redir.p.out redir.y.tst redir.y.out \
	sig.p.tst sig.p.out sig.y.tst sig.y.out \
	test.y.tst test.y.out \
	variable.p.tst variable.p.out variable.y.tst variable.y.out

TEST_ITEMS = *.tst  # the default test items

BYPRODUCTS = invoke.o invoke resetsig.o resetsig *.dSYM

test test-all: invoke resetsig
	@./resetsig $(SHELL) ./run-test.sh
test-posix:
	@$(MAKE) TEST_ITEMS='*.p.tst' test
test-yash:
	@$(MAKE) TEST_ITEMS='*.y.tst' test

.c:
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $< $(LDLIBS)
.c.o:
	$(CC) $(CFLAGS) -c $<

DISTCONTENTS = $(SOURCES) $(SOURCES:.c=.d) $(TEST_SOURCES) Makefile.in run-test.sh
# "distcontents" depends on object files to ensure all *.d files up-to-date
distcontents: $(DISTCONTENTS) invoke resetsig
copy-distcontents: distcontents
	mkdir -p $(DISTTARGETDIR)
	@echo Copying contents to $(DISTTARGETDIR)
	@for f in $(DISTCONTENTS); do ln $$f $(DISTTARGETDIR); done

clean:
	rm -fr $(BYPRODUCTS)
distclean: clean
	rm -fr Makefile
maintainer-clean: distclean
	rm -fr $(SOURCES:.c=.d)

.PHONY: test test-all test-posix test-yash distcontents copy-distcontents clean distclean maintainer-clean

@MAKE_INCLUDE@ invoke.d
@MAKE_INCLUDE@ resetsig.d
