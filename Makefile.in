# Makefile.in for yash: yet another shell
# (C) 2007-2009 magicant
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 2 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

.POSIX:
.SUFFIXES: .c .h .o .a

CC = @CC@
CFLAGS = @CFLAGS@
LDFLAGS = @LDFLAGS@
LDLIBS = @LDLIBS@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
SOURCES = @SOURCES@
OBJS = @OBJS@
TARGET = @TARGET@
MKSIGNUMOBJS = mksignum.o

BYPRODUCTS = mksignum signum.h

all: $(TARGET)

# Though these rules are exactly the same as the default rules defined by POSIX,
# we re-define them here because at least GNU Make is not fully compliant.
.c:
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $<
.c.o:
	$(CC) $(CFLAGS) -c $<

$(TARGET): $(OBJS)
	$(CC) $(LDFLAGS) -o $@ $(OBJS) $(LDLIBS)
builtins/@BUILTINS_ARCHIVE@: _PHONY
	@cd builtins && $(MAKE)
mksignum: $(MKSIGNUMOBJS)
	$(CC) $(LDFLAGS) -o $@ $(MKSIGNUMOBJS) $(LDLIBS)
signum.h: mksignum
	./mksignum > $@

test check: $(TARGET)
	@cd tests && $(MAKE) test-all

BINDIR = @BINDIR@
install: $(TARGET) $(BINDIR)
	$(INSTALL_PROGRAM) -c $(TARGET) '$(BINDIR)/$(TARGET)'
install-strip: $(TARGET) $(BINDIR)
	$(INSTALL_PROGRAM) -c -s $(TARGET) '$(BINDIR)/$(TARGET)'
installdirs: $(BINDIR)
$(BINDIR):
	$(INSTALL_PROGRAM) -d $@
uninstall:
	rm -f '$(BINDIR)/$(TARGET)'

PACKAGE = @PACKAGE@
VERSION = @VERSION@
DISTDIR = @DISTDIR@
DISTS = $(DISTDIR).tar.Z $(DISTDIR).tar.gz $(DISTDIR).tar.bz2 $(DISTDIR).shar.gz $(DISTDIR).zip
DISTCONTENTS = $(SOURCES) README README.ja COPYING INSTALL INSTALL.ja NEWS NEWS.ja configure Makefile.in install-sh
distcontents: $(DISTCONTENTS)
$(DISTDIR):
	mkdir -p $@
	for i in . $$(grep / .distfiles | sed -e 's;/[^/]*$$;;' | sort -u); do \
		(cd $$i && $(MAKE) distcontents); \
		mkdir -p $@/$$i; \
	done
	while read -r i; do \
		cp -fRL $$i $@/$${i%/*}; \
	done < .distfiles
# Only pax and compress comform to POSIX.
dist-tarZ: $(DISTDIR).tar.Z
	-rm -rf $(DISTDIR)
dist dist-gzip: $(DISTDIR).tar.gz
	-rm -rf $(DISTDIR)
dist-bzip2: $(DISTDIR).tar.bz2
	-rm -rf $(DISTDIR)
dist-shar: $(DISTDIR).shar.gz
	-rm -rf $(DISTDIR)
dist-zip: $(DISTDIR).zip
	-rm -rf $(DISTDIR)
dist-all: $(DISTS)
	-rm -rf $(DISTDIR)
$(DISTDIR).tar.Z: $(DISTDIR)
	pax -w -x ustar $(DISTDIR) | compress -c > $@
$(DISTDIR).tar.gz: $(DISTDIR)
	tar -c $(DISTDIR) | gzip -c > $@
$(DISTDIR).tar.bz2: $(DISTDIR)
	tar -c $(DISTDIR) | bzip2 -9 -c > $@
$(DISTDIR).shar.gz: $(DISTDIR)
	shar -q -T $(DISTDIR) | gzip -c > $@
$(DISTDIR).zip: $(DISTDIR)
	zip -rq $@ $(DISTDIR)

# ctags conforms to POSIX, but etags and cscope do not.
CTAGSARGS = @CTAGSARGS@
ETAGSARGS = @ETAGSARGS@
tags: $(SOURCES)
	ctags $(CTAGSARGS)
TAGS: $(SOURCES)
	etags $(ETAGSARGS)
cscope: cscope.out
cscope.out: $(SOURCES)
	cscope -b

mostlyclean: _mostlyclean
	-@cd builtins && $(MAKE) mostlyclean
_mostlyclean:
	-rm -rf $(OBJS) $(MKSIGNUMOBJS) $(BYPRODUCTS) $(DISTDIR)
	-@cd tests && $(MAKE) clean
clean: _clean
	-@cd builtins && $(MAKE) clean
_clean: _mostlyclean
	-rm -rf $(TARGET) $(DISTS)
distclean: _distclean
	-@cd builtins && $(MAKE) distclean
_distclean: _clean
	-rm -rf Makefile config.cache config.log config.h version.h tags TAGS cscope.out
maintainer-clean:
	@echo 'This command is intended for maintainers to use;'
	@echo 'it deletes files that may need special tools to rebuild.'
	@$(MAKE) distclean

reconfigure:
	@{ line=$$(sed -n -e '/# Invocation command line was:/ { n;s/% //;p;q \
	}' config.log) && { echo "$$line"; eval "$$line"; }; } || \
	echo Cannot read \"config.log\". Try usual \"./configure\" >&2

.PHONY: all test check install install-strip installdirs uninstall dist distcontents dist-tarZ dist-gzip dist-bzip2 dist-shar dist-zip dist-all cscope mostlyclean _mostlyclean clean _clean distclean _distclean maintainer-clean reconfigure
_PHONY:

# source file dependencies
alias.o: alias.h builtin.h common.h config.h exec.h expand.h hashtable.h option.h parser.h plist.h strbuf.h util.h
arith.o: arith.h common.h config.h option.h strbuf.h util.h variable.h
builtin.o: alias.h builtin.h builtins/printf.h builtins/test.h builtins/ulimit.h common.h config.h exec.h hashtable.h history.h job.h option.h path.h sig.h strbuf.h util.h variable.h yash.h
exec.o: alias.h builtin.h common.h config.h exec.h expand.h input.h job.h option.h parser.h path.h plist.h redir.h sig.h strbuf.h util.h variable.h wfnmatch.h yash.h
expand.o: arith.h common.h config.h exec.h expand.h input.h option.h parser.h path.h plist.h strbuf.h util.h variable.h wfnmatch.h yash.h
hashtable.o: common.h config.h hashtable.h util.h
history.o: builtin.h common.h config.h exec.h history.h job.h option.h path.h redir.h strbuf.h util.h variable.h yash.h
job.o: builtin.h common.h config.h exec.h job.h option.h plist.h redir.h sig.h strbuf.h util.h yash.h
input.o: common.h config.h exec.h expand.h history.h input.h job.h mail.h option.h parser.h sig.h strbuf.h util.h variable.h yash.h
option.o: builtin.h common.h config.h exec.h option.h redir.h sig.h strbuf.h util.h variable.h yash.h
mail.o: common.h config.h expand.h hashtable.h mail.h parser.h strbuf.h util.h variable.h
mksignum.o: common.h config.h siglist.h
parser.o: alias.h common.h config.h expand.h input.h option.h parser.h plist.h strbuf.h util.h
path.o: builtin.h common.h config.h exec.h hashtable.h option.h path.h plist.h redir.h strbuf.h util.h variable.h wfnmatch.h yash.h
plist.o: common.h config.h plist.h util.h
redir.o: common.h config.h exec.h expand.h input.h option.h parser.h path.h redir.h sig.h strbuf.h util.h yash.h
sig.o: builtin.h common.h config.h exec.h expand.h job.h option.h parser.h redir.h sig.h siglist.h signum.h strbuf.h util.h yash.h
strbuf.o: common.h config.h strbuf.h util.h
util.o: common.h config.h exec.h option.h plist.h util.h
variable.o: builtin.h common.h config.h exec.h expand.h hashtable.h input.h option.h parser.h path.h plist.h strbuf.h util.h variable.h version.h yash.h
wfnmatch.o: common.h config.h strbuf.h wfnmatch.h
yash.o: alias.h builtin.h common.h config.h exec.h expand.h history.h input.h job.h option.h parser.h path.h redir.h sig.h strbuf.h util.h variable.h version.h yash.h
