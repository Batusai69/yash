<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 10.2.0" />
<meta name="description" content="This page describes how commands are executed by yash." />
<title>Command execution</title>
<link rel="stylesheet" href="./asciidoc.css" type="text/css" />


</head>
<body class="article">
<div id="header">
<h1>Command execution</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>This section describes how commands are executed.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="simple">Execution of simple commands</h2>
<div class="sectionbody">
<div class="paragraph"><p><a href="syntax.html#simple">A simple command</a> is executed as follows:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
All tokens in the simple command are <a href="expand.html">expanded</a> except for
  assignment and redirection tokens.
  If an error occurs during expansion, the execution of the simple command is
  aborted with a non-zero exit status.
 <br />
  In the following steps, the first word of the expansion results is referred
  to as <dfn>command name</dfn>, and the other words as <dfn>command arguments</dfn>.
  If there is only one word of the expansion results, there are no command
  argument words.
  If there are none of the expansion results, there is no command name either.
</p>
</li>
<li>
<p>
If the command name exists and there are any <a href="redir.html">redirections</a>
  specified in the command, they are processed.
  The word token after each redirection operator is expanded.
  If an error occurs during processing the redirections (including when
  expanding the word token), the execution of this simple command is aborted
  with a non-zero exit status.
</p>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">In other shells, redirections may be processed in a different step:
POSIX does not specify the order in which redirections and assignments are
processed when there is no command name or the name denotes a
<a href="builtin.html#types">special built-in</a>.</td>
</tr></table>
</div>
</li>
<li>
<p>
Assignments specified in the command, if any, are processed.
  For each assignment token, the value is expanded and assigned to the
  specified <a href="params.html#variables">variable</a>.
  If an error occurs during assignments (including when expanding the values
  to be assigned), the execution of this simple command is aborted with a
  non-zero exit status.
</p>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
If there is no command name or the name denotes a
<a href="builtin.html#types">special built-in</a>, the
assignments are permanent: the assigned values remain after the command
has finished (until the variable is reassigned).
</p>
</li>
<li>
<p>
Otherwise, the assignments are temporary: the assigned values only last
during the execution of this simple command.
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p>The assigned variables are automatically <a href="params.html#variables">exported</a>
when the command name is specified or the
<a href="_set.html#so-allexport">all-export option</a> is enabled.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">In other shells, assignments may behave differently: For special built-ins and
functions, assigned variables may not be exported. For functions, assigned
variables may be persistent, that is, may remain even after the execution of
the simple command.</td>
</tr></table>
</div>
</li>
<li>
<p>
If there is no command name, the <a href="redir.html">redirections</a> are processed
  in a <a href="#subshell">subshell</a>, then the command execution ends.
  If an error occurs in the redirections,
  the exit status of the simple command is non-zero.
  If there were any <a href="expand.html#cmdsub">command substitutions</a> performed
  in the assignments, the exit status of the simple command is that of the
  last executed command substitution.
  Otherwise, the exit status is zero.
</p>
</li>
<li>
<p>
A command to be executed is determined using the <a href="#search">command search   algorithm</a> and the command is executed.
</p>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
If the command is an external command, the command is executed by creating
  a new <a href="#subshell">subshell</a> and calling the &#8220;exec&#8221; system call in the
  subshell.
  The command name and arguments are passed to the executed command.
  Exported variables are passed to the executed command as environment
  variables.
</p>
</li>
<li>
<p>
If the command is a <a href="builtin.html">built-in</a>, the built-in is executed
  with the command arguments passed to the built-in. As an exception, in the
  <a href="posix.html">POSIXly-correct mode</a>, the built-in is not executed if it is
  an <a href="builtin.html#types">elective built-in</a>.
</p>
</li>
<li>
<p>
If the command is a <a href="#function">function</a>, the contents of the function
  are executed with the command arguments as function arguments.
</p>
</li>
</ul></div>
<div class="paragraph"><p>If the command was executed, the exit status of this simple command is that
of the executed command.
If the algorithm failed to determine a command, no command is executed and
the exit status is 127.
If the shell failed to execute the determined command, the exit status is
126.
If the executed command was killed by a signal, the exit status is the signal
number plus 384.
If the elective built-in was not executed in the POSIXly-correct mode, the
exit status is 127.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">In shells other than yash, the exit status may be different when the command
was killed by a signal, because the POSIX standard only requires that the exit
status be "greater than 128."</td>
</tr></table>
</div>
<div class="paragraph"><p>If the shell is not in the <a href="posix.html">POSIXly-correct mode</a> and the
algorithm failed to determine a command, the command
<code><a href="_eval.html">eval</a> -i -- "${COMMAND_NOT_FOUND_HANDLER-}"</code>
is evaluated.
During the command execution, <a href="params.html#positional">positional
parameters</a> are temporarily set to the command name and arguments that
resulted in the first step.
Any <a href="#localvar">local variables</a> defined during the execution are removed
when the execution is finished.
The <code>HANDLED</code> local variable is automatically defined with the initial value
being the empty string.
If the <code>HANDLED</code> variable has a non-empty value when the execution of the
command string is finished, the shell pretends that the command was
successfully determined and executed.
The exit status of the simple command is that of the command string in this
case.</p></div>
</div></div>
</li>
</ol></div>
<div class="sect2">
<h3 id="search">Command search</h3>
<div class="paragraph"><p>A command that is executed in a simple command is determined by the command
name using the following algorithm:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
If the command name contains a slash (<code>/</code>), the whole name is treated as the
  pathname of an external command. The external command is determined as the
  executed command.
</p>
</li>
<li>
<p>
If the command name is a <a href="builtin.html#types">special built-in</a>, the
  built-in is determined as the executed command.
</p>
</li>
<li>
<p>
If the command name is the name of an existing <a href="#function">function</a>, the
  function is determined as the executed command.
</p>
</li>
<li>
<p>
If the command name is a <a href="builtin.html#types">mandatory or elective
  built-in</a>, the built-in is determined as the executed command.
</p>
</li>
<li>
<p>
If the command name is an <a href="builtin.html#types">extension built-in</a> and
  the shell is not in the <a href="posix.html">POSIXly-correct mode</a>, the built-in
  is determined as the executed command.
</p>
</li>
<li>
<p>
The shell searches the PATH for a executed command:
</p>
<div class="openblock">
<div class="content">
<div class="paragraph"><p>The value of the <a href="params.html#sv-path"><code>PATH</code> variable</a> is separated by
colons.
Each separated part is considered as a directory pathname
(an empty pathname denotes the current working directory).
The shell searches the directories (in the order of appearance) and checks if
any directory directly contains an executable regular file whose name is equal
to the command name.
If such a file is found:</p></div>
<div class="ulist"><ul>
<li>
<p>
If the command name is the name of a <a href="builtin.html#types">substitutive
  built-in</a>, the built-in is determined as the executed command.
</p>
</li>
<li>
<p>
Otherwise, the file is determined as the executed command.
  (The file will be executed as an external command.)
</p>
</li>
</ul></div>
<div class="paragraph"><p>If no such file is found, no command is determined as the executed command.</p></div>
</div></div>
</li>
</ol></div>
<div class="paragraph"><p>When the shell finds a file that matches the command name during the search
above, the shell remembers the pathname of the file if it is an absolute path.
When the algorithm above is used for the same command name again, the shell
skips searching and directly determines the command to be executed.
If an executable regular file no longer exists at the remembered pathname,
however, the shell searches again to update the remembered pathname.
You can manage remembered pathnames using the <a href="_hash.html">hash built-in</a>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exit">Termination of the shell</h2>
<div class="sectionbody">
<div class="paragraph"><p>The shell exits when it reached the end of input and has parsed and executed
all input commands or when the <a href="_exit.html">exit built-in</a> is executed.
The exit status of the shell is that of the last command the shell executed
(or zero if no commands were executed).
The exit status of the shell is always between 0 and 255 (inclusive).
If the exit status of the last command is 256 or larger, the exit status of
the shell will be the remainder of the exit status divided by 256.</p></div>
<div class="paragraph"><p>If an exit handler has been registered by the <a href="_trap.html">trap built-in</a>,
the handler is executed just before the shell exits.
The exit status of the commands executed in the handler does not affect the
exit status of the shell.</p></div>
<div class="paragraph"><p>If a non-<a href="interact.html">interactive</a> shell encountered one of the
following errors, the shell immediately exits with a non-zero exit status:</p></div>
<div class="ulist"><ul>
<li>
<p>
A command cannot be parsed due to an syntax error (except during
  <a href="invoke.html#init">shell initialization</a>).
</p>
</li>
<li>
<p>
An error occurs during execution of a <a href="builtin.html#types">special
  built-in</a> in the <a href="posix.html">POSIXly-correct mode</a>.
</p>
</li>
<li>
<p>
A <a href="redir.html">redirection</a> error occurs in a
  <a href="syntax.html#simple">simple command</a> whose command name is a special
  built-in and the shell is in the POSIXly-correct mode.
</p>
</li>
<li>
<p>
An assignment error occurs in a simple command.
</p>
</li>
<li>
<p>
An error occurs during <a href="expand.html">expansion</a> (except during shell
  initialization).
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Some shells other than yash exit when they fail to find a command to execute
in <a href="#search">command search</a>.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="function">Functions</h2>
<div class="sectionbody">
<div class="paragraph"><p><dfn>Functions</dfn> allow executing a <a href="syntax.html#compound">compound command</a>
as a <a href="syntax.html#simple">simple command</a>.
A function can be defined by the <a href="syntax.html#funcdef">function definition
command</a> and executed by a simple command.
You can use the <a href="_unset.html">unset built-in</a> to remove function
definitions.</p></div>
<div class="paragraph"><p>There are no functions predefined when yash is started.</p></div>
<div class="paragraph"><p>A function is executed by executing its body, which is a compound command.
While the function is being executed, <a href="params.html#positional">positional
parameters</a> are set to the arguments given to the function.
The old positional parameters are restored when the function execution
finishes.</p></div>
<div class="sect2">
<h3 id="localvar">Local variables</h3>
<div class="paragraph"><p><dfn>Local variables</dfn> are temporary variables that are defined in a function
and exist during the function execution only.
They can be defined by the <a href="_typeset.html">typeset built-in</a>
or implicitly created by a <a href="syntax.html#for">for loop</a>.
They are removed when the function execution finishes.</p></div>
<div class="paragraph"><p>Local variables may <em>hide</em> variables that have already been defined before
the function execution had started.
An existing variable becomes inaccessible if a local variable of the same name
is defined in a function.
The old variable becomes accessible again when the function execution
finishes.</p></div>
<div class="paragraph"><p>You cannot create a local variable when not executing a function.
A normal variable is created if you try to do so.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="environment">Command execution environment</h2>
<div class="sectionbody">
<div class="paragraph"><p>The shell holds following properties during execution.</p></div>
<div class="ulist"><ul>
<li>
<p>
The working directory
</p>
</li>
<li>
<p>
Open file descriptors
</p>
</li>
<li>
<p>
The file creation mask (<a href="_umask.html">umask</a>)
</p>
</li>
<li>
<p>
The set of signals whose handler is set to &#8220;ignore&#8221; (<a href="_trap.html">trap</a>)
</p>
</li>
<li>
<p>
<a href="params.html#variables">Environment variables</a>
</p>
</li>
<li>
<p>
Resource limits (<a href="_ulimit.html">ulimit</a>)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Those properties are inherited from the invoker of the shell to the shell, and
from the shell to each external command executed by the shell.</p></div>
<div class="paragraph"><p>The properties can be changed during the execution of the shell by built-in
commands, variable assignments, etc.</p></div>
<div class="sect2">
<h3 id="subshell">Subshells</h3>
<div class="paragraph"><p>A <dfn>subshell</dfn> is a copy of the shell process.
Subshells are used in execution of <a href="syntax.html#grouping">groupings</a>,
<a href="syntax.html#pipelines">pipelines</a>, etc.</p></div>
<div class="paragraph"><p>Subshells inherit functions, aliases, etc. defined in the shell as well as the
properties above since subshells are copies of the shell process.
Notable exceptions are:</p></div>
<div class="ulist"><ul>
<li>
<p>
Traps registered by the <a href="_trap.html">trap built-in</a> are all reset in
  subshells except for ones whose action is set to &#8220;ignore&#8221;. (See below)
</p>
</li>
<li>
<p>
The <a href="interact.html">interactive</a> mode and <a href="job.html">job control</a> are
  disabled in subshells.
  Jobs are not inherited by subshells.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Subshells are executed independently of the original shell, so changes of
any properties above do not affect those of the original shell.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">If the subshell contains a single trap built-in, some shells (but not yash)
may not reset the traps on entry to the subshell.</td>
</tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated
 2023-04-22 01:39:14 JST
</div>
</div>
</body>
</html>
